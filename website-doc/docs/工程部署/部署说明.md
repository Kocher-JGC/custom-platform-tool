---
id: 前端 3.0 工程整体部署说明
slug: /前端 3.0 工程整体部署说明
hide_title: true
---


# 前端 3.0 工程整体部署说明

## 1. 先决条件

- 向运维申请带 docker 环境的服务器

---

## 2. 服务器

- 版本：centos 7

---

## 3. 部署

### 3.1. 部署配置平台前端

进入虚拟机后，使用 root 用户操作，并开始创建必要的环境配置文件：

```shell
sudo su -
mkdir -p /var/custom-platform-app/config
cd /var/custom-platform-app/config
```

创建应用端的配置：

```shell
vi provider-app-config.json
```

输入并编辑以下内容：

FEResourceServerUrl: 前端资源服务
paasServerUrl: paas 接口地址
saasServerUrlForPreviewApp: 预览时的 saas 地址
previewAppEntryUrl: 预览应用端的入口地址

```json
{
  "FEResourceServerUrl": "http://192.168.14.181:5100",
  "paasServerUrl": "http://192.168.14.181:6090",
  "saasServerUrlForPreviewApp": "http://192.168.14.181:7090",
  "previewAppEntryUrl": "http://192.168.14.181:5020"
}
```

通过 docker 启动配置端：

```shell
# 1. 停止已部署的应用
docker stop provider_app

# 2. 删除该应用容器
docker rm provider_app

# 3. 拉去最新的应用
docker pull reg.hydevops.com/custom-platform-v3-frontend/provider_app:release-main-flow

# 4. 通过 docker 启动应用
docker run -d --name provider_app -p 5010:80 -v /var/custom-platform-app/config/provider-app-config.json:/usr/share/nginx/html/config.json reg.hydevops.com/custom-platform-v3-frontend/provider_app:release-main-flow
```

#### 3.1.1. 查看是否启动成功

```shell
docker ps | grep provider_app
```

---

### 2.2. 准备环境配置

进入虚拟机后，使用 root 用户操作，并开始创建必要的环境配置文件：

```shell
sudo su -
mkdir -p /var/custom-platform-app/config
cd /var/custom-platform-app/config
```

#### 2.2.1. 创建应用的配置文件

```shell
vi consumer-app-config.json
```

##### 输入并编辑以下内容

_以下皆为必要配置，缺一不可_

pageServerUrlForApp: 页面服务器的地址，写当前应用的服务地址即可，例如应用部署在 192.168.14.181，写 192.168.14.181 即可
saasServerUrl: 向 saas 服务发送请求的地址

```json
{
  "pageServerUrlForApp": "http://192.168.14.181:5020",
  "saasServerUrl": "http://192.168.14.181:7090"
}
```

### 2.3. 通过 docker 启动程序

```shell
# 1. 停止已部署的应用。如果是第一次部署，则不需要
docker stop consumer_app

# 2. 删除该应用容器。如果是第一次部署，则不需要
docker rm consumer_app

# 3. 获取最新的应用 docker 镜像
docker pull reg.hydevops.com/custom-platform-v3-frontend/consumer_app:release-main-flow

# 4. 通过 docker 启动应用
docker run -d --name consumer_app -p 5020:3000 -v /var/custom-platform-app/config/consumer-app-config.json:/usr/share/consumer-app/web-client/config.json reg.hydevops.com/custom-platform-v3-frontend/consumer_app:release-main-flow
```

### 2.4. 查看是否启动成功

```shell
docker ps | grep consumer_app
```

通过打开应用地址查看，例如 `http://192.168.14.181:5020` 查看。

---

### 3.3. 部署 node web 服务器

```shell
docker run -d -p 9090:80 reg.hydevops.com/custom-platform-v3-frontend/web-server:TAG
```

修改配置文件
