# 前端 3.0 工程整体部署说明

## 1. 安装说明

---

### 1.1. 先决条件

- 向运维申请带 docker 环境的服务器

---

### 1.2. 服务器

- 版本：centos 7

---

### 1.3. 部署

#### 1.3.1. 部署配置平台前端

进入虚拟机后，使用 root 用户操作，并开始创建必要的环境配置文件：

```shell
sudo su -
mkdir -p /var/custom-platform-app/config
cd /var/custom-platform-app/config
```

创建应用端的配置：

```shell
vi provider-app-config.json
```

输入并编辑以下内容：

```json
{
  "FEResourceServerUrl": "http://192.168.14.181:5100", // 前端资源服务
  "paasServerUrl": "http://192.168.14.181:6090", // paas 接口地址
  "saasServerUrlForPreviewApp": "http://192.168.14.181:7090", // 预览时的 saas 地址
  "previewAppEntryUrl": "http://192.168.14.181:5020" // 预览应用端的入口地址
}
```

通过 docker 启动配置端：

```shell
# 1. 停止已部署的应用
docker stop provider_app

# 2. 删除该应用容器
docker rm provider_app

# 3. 拉去最新的应用
docker pull reg.hydevops.com/custom-platform-v3-frontend/provider-app-entry:release-main-flow

# 4. 通过 docker 启动应用
docker run -d --name provider_app -p 7070:80 -v /var/custom-platform-app/config/provider-app-config.json:/usr/share/nginx/html/config.json reg.hydevops.com/custom-platform-v3-frontend/provider-app-entry:release-main-flow
```

#### 1.3.2. 查看是否启动成功

```shell
docker ps
```

查看是否有 `provider_app` 的名字的容器的应用。

---

#### 1.3.3. 部署应用平台前端

进入虚拟机后，使用 root 用户操作，并开始创建必要的环境配置文件：

```shell
sudo su -
mkdir -p /var/custom-platform-app/config
cd /var/custom-platform-app/config
```

创建应用端的配置：

```shell
vi consumer-app-config.json
```

输入并编辑以下内容：

```json
{
  "pageServerUrlForApp": "http://192.168.14.181:5020", // 向 saas 发送请求的地址
  "saasServerUrl": "http://192.168.14.181:7090" // 页面服务器的地址
}
```

通过 docker 启动配置端：

```shell
# 1. 停止已部署的应用
docker stop consumer_app

# 2. 删除该应用容器
docker rm consumer_app

# 3. 拉去最新的应用
docker pull reg.hydevops.com/custom-platform-v3-frontend/consumer-app-entry:release-main-flow

# 4. 通过 docker 启动应用
docker run -d -p 7070:80 -v /var/custom-platform-app/config/consumer-app-config.json:/usr/share/web-platform-update/app/config.json reg.hydevops.com/custom-platform-v3-frontend/consumer-app-entry:release-main-flow
```

#### 1.3.4. 查看是否启动成功

```shell
docker ps
```

查看是否有 `consumer_app` 的名字的容器的应用。

---

#### 1.3.5. 部署 node web 服务器

```shell
docker run -d -p 9090:80 reg.hydevops.com/custom-platform-v3-frontend/web-server:TAG
```

修改配置文件
