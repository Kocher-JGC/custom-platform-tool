# 应用前端程序部署 & 应用安装说明

## 1. 概览

1. 通过`配置平台`将应用导出，其中包含：
   1. 前端安装包
   2. 后端安装包
2. 通过 vps （或者物理机器）部署应用前端程序：
   1. 申请包含 docker 的虚拟机
   2. 按照章节 `部署应用前端程序` 操作
3. 通过可视化界面安装导出的应用：
   1. 通过登入`应用服务的 ip 地址:5020/app-installation`可视化安装界面，例如 `http://192.168.14.181:5020/app-installation`，分别上传安装包。
4. 通过`应用服务的 ip 地址:5020`查看应用是否已安装成功。

## 2. 部署应用前端程序

### 2.1. 先决条件

- 向运维申请带 docker 环境的服务器
- 版本：centos 7

### 2.2. 准备环境配置

进入虚拟机后，使用 root 用户操作，并开始创建必要的环境配置文件：

```shell
sudo su -
mkdir -p /var/custom-platform-app/config
cd /var/custom-platform-app/config
```

#### 2.2.1. 创建应用的配置文件

```shell
vi consumer-app-config.json
```

##### 输入并编辑以下内容

_以下皆为必要配置，缺一不可_

```json
{
  "pageServerUrlForApp": "http://192.168.14.181:5020", // 向 saas 服务发送请求的地址
  "saasServerUrl": "http://192.168.14.181:7090", // 页面服务器的地址
  "currentApp": "zxx" // 指定启动的应用的编码，根据实际启动来
}
```

### 2.3. 通过 docker 启动程序

```shell
# 1. 停止已部署的应用。如果是第一次部署，则不需要
docker stop consumer_app

# 2. 删除该应用容器。如果是第一次部署，则不需要
docker rm consumer_app

# 3. 获取最新的应用 docker 镜像
docker pull reg.hydevops.com/custom-platform-v3-frontend/consumer_app:release-main-flow

# 4. 通过 docker 启动应用
docker run -d --name consumer_app -p 5020:3000 -v /var/custom-platform-app/config/consumer-app-config.json:/usr/share/consumer-app/web-client/config.json reg.hydevops.com/custom-platform-v3-frontend/consumer_app:release-main-flow
```

### 2.4. 查看是否启动成功

```shell
docker ps | grep consumer_app
```

通过打开应用地址查看，例如 `http://192.168.14.181:5020` 查看。
